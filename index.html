<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flow Game â€“ Intro</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Flow Game">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-image: url('background.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: hidden;
    }

    .overlay {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(255, 255, 255, 0.1));
      min-height: 100vh;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: opacity 0.3s ease-in-out;
    }

    .overlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .overlay.fade-in {
      opacity: 1;
      pointer-events: auto;
    }

    .game-container {
      background-image: url('container-background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 800px;
      width: 100%;
      padding: 30px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeIn 1s ease-in-out;
      max-height: 90vh;
      overflow-y: auto;
      will-change: transform, opacity;
      transform: translateZ(0);
    }

    .logo {
      background-image: url('logo.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      width: 240px;
      height: 240px;
      margin: 0 auto 20px;
    }

    .start-button {
      background-image: url('startbutton.png');
      background-size: cover;
      background-position: center;
      width: 200px;
      height: 60px;
      border: none;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin: 20px auto;
      border-radius: 30px;
      color: white;
      font-size: 1.2em;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      display: block;
      will-change: transform;
      backface-visibility: hidden;
    }

    .start-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .start-button:focus {
      outline: 3px solid #667eea;
      outline-offset: 2px;
    }

    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .level-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      will-change: transform;
      backface-visibility: hidden;
    }

    .level-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      border-color: #667eea;
    }

    .level-card:focus {
      outline: 3px solid #667eea;
      outline-offset: 2px;
      border-color: #667eea;
    }

    .level-emoji {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .level-title {
      font-size: 1.1em;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }

    .level-emotions {
      font-size: 0.9em;
      color: #7f8c8d;
      line-height: 1.4;
    }

    .back-button {
      background: rgba(149, 165, 166, 0.9);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s ease;
      font-size: 1em;
    }

    .back-button:hover {
      background: rgba(127, 140, 141, 0.9);
      transform: translateY(-2px);
    }

    .back-button:focus {
      outline: 3px solid #667eea;
      outline-offset: 2px;
    }

    .content-text {
      color: #34495e;
      font-size: 1.1em;
      line-height: 1.6;
      text-align: left;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      max-height: 60vh;
      overflow-y: auto;
    }

    .action-text {
      color: #34495e;
      font-size: 1.0em;
      line-height: 1.6; /* Increased line-height for better readability */
      text-align: left;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      max-height: 60vh;
      overflow-y: auto;
      /* white-space: pre-line; Removed as we'll use proper HTML for formatting */
    }

    .action-text h3 {
        color: #2c3e50;
        margin-top: 15px;
        margin-bottom: 10px;
        font-size: 1.2em;
    }

    .action-text strong {
        color: #2c3e50;
    }

    .action-text ul {
        list-style: none; /* Remove default bullet */
        padding-left: 0;
        margin-bottom: 15px;
    }

    .action-text ul li {
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
    }

    .action-text ul li::before {
        content: 'â€¢'; /* Custom bullet point */
        color: #667eea;
        position: absolute;
        left: 0;
        font-weight: bold;
    }

    .action-text p {
        margin-bottom: 15px;
    }

    .progress-indicator {
      margin: 10px 0;
      font-size: 0.9em;
      color: #7f8c8d;
      background: rgba(255, 255, 255, 0.1);
      padding: 8px 15px;
      border-radius: 20px;
      display: inline-block;
    }

    .level-highlight {
      margin: 15px 0;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .error-message {
      background: rgba(231, 76, 60, 0.1);
      color: #e74c3c;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #e74c3c;
      display: none;
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .pulsing {
      animation: pulse 1.5s infinite;
    }

    /* Responsive Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ - Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ´Ğ»Ñ ÑĞ»Ğ°Ğ±Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² */
    @media (prefers-reduced-motion: reduce) {
      .game-container,
      .level-card,
      .start-button,
      .back-button {
        animation: none !important;
        transition: none !important;
      }
      
      .overlay {
        transition: none !important;
      }
    }

    @media (max-width: 768px) {
      .game-container {
        padding: 20px;
        margin: 10px;
        max-width: 600px;
      }

      .logo {
        width: 160px;
        height: 160px;
      }

      .level-grid {
        grid-template-columns: 1fr;
      }

      .content-text, .action-text {
        font-size: 0.95em;
        padding: 15px;
      }
    }

    /* Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ */
    .content-text, .action-text {
      contain: layout style paint;
    }

    .level-card {
      contain: layout style paint;
    }
  </style>
</head>
  
<body>
  <audio id="backgroundMusic" loop>
    <source src="music.mp3" type="audio/mpeg" />
  </audio>

  <div id="introScreen" class="overlay">
    <div class="game-container">
      <div class="logo"></div>
      <button class="start-button" onclick="startGame()" 
              aria-label="Start your emotional journey"
              tabindex="0">Start Your Journey</button>
    </div>
  </div>

  <div id="levelSelection" class="overlay" style="display: none;">
    <div class="game-container">
      <h2 style="color: #2c3e50; margin-bottom: 20px;">How are you feeling right now?</h2>
      <div class="progress-indicator" id="progressIndicator" style="display: none;">
        Explored levels: 0/9
      </div>
      <p style="color: #7f8c8d; margin-bottom: 25px;">Choose the level that best describes your current emotional state:</p>
      <div class="error-message" id="errorMessage">
        Something went wrong. Please try again.
      </div>
      <div class="level-grid">
        <div class="level-card level-1" onclick="selectLevel(1)" 
             tabindex="0" role="button" 
             aria-label="Select Level 1: Deep Negativity"
             onkeypress="handleKeyPress(event, 1)">
          <div class="level-emoji">ğŸ”´</div>
          <div class="level-title">Level 1: Deep Negativity</div>
          <div class="level-emotions">Humiliated, Desperate, Depressed, Powerless</div>
        </div>
        <div class="level-card level-2" onclick="selectLevel(2)" 
             tabindex="0" role="button" 
             aria-label="Select Level 2: Heavy Experiences"
             onkeypress="handleKeyPress(event, 2)">
          <div class="level-emoji">ğŸŸ </div>
          <div class="level-title">Level 2: Heavy Experiences</div>
          <div class="level-emotions">Disappointed, Empty, Numb, Hopeless</div>
        </div>
        <div class="level-card level-3" onclick="selectLevel(3)" 
             tabindex="0" role="button" 
             aria-label="Select Level 3: Negative Activation"
             onkeypress="handleKeyPress(event, 3)">
          <div class="level-emoji">ğŸ”´</div>
          <div class="level-title">Level 3: Negative Activation</div>
          <div class="level-emotions">Angry, Irritated, Upset, Critical</div>
        </div>
        <div class="level-card level-4" onclick="selectLevel(4)" 
             tabindex="0" role="button" 
             aria-label="Select Level 4: Neutral Negativity"
             onkeypress="handleKeyPress(event, 4)">
          <div class="level-emoji">ğŸŸ¤</div>
          <div class="level-title">Level 4: Neutral Negativity</div>
          <div class="level-emotions">Bored, Embarrassed, Uncertain, Doubtful</div>
        </div>
        <div class="level-card level-5" onclick="selectLevel(5)" 
             tabindex="0" role="button" 
             aria-label="Select Level 5: Neutral State"
             onkeypress="handleKeyPress(event, 5)">
          <div class="level-emoji">âšª</div>
          <div class="level-title">Level 5: Neutral State</div>
          <div class="level-emotions">Calm, Content, Relaxed, Focused</div>
        </div>
        <div class="level-card level-6" onclick="selectLevel(6)" 
             tabindex="0" role="button" 
             aria-label="Select Level 6: Light Positivity"
             onkeypress="handleKeyPress(event, 6)">
          <div class="level-emoji">ğŸŸ¡</div>
          <div class="level-title">Level 6: Light Positivity</div>
          <div class="level-emotions">Interested, Curious, Hopeful, Accepting</div>
        </div>
        <div class="level-card level-7" onclick="selectLevel(7)" 
             tabindex="0" role="button" 
             aria-label="Select Level 7: Active Positivity"
             onkeypress="handleKeyPress(event, 7)">
          <div class="level-emoji">ğŸŸ¢</div>
          <div class="level-title">Level 7: Active Positivity</div>
          <div class="level-emotions">Energetic, Motivated, Inspired, Confident</div>
        </div>
        <div class="level-card level-8" onclick="selectLevel(8)" 
             tabindex="0" role="button" 
             aria-label="Select Level 8: High Positivity"
             onkeypress="handleKeyPress(event, 8)">
          <div class="level-emoji">ğŸŸ¡</div>
          <div class="level-title">Level 8: High Positivity</div>
          <div class="level-emotions">Joyful, Grateful, Enthusiastic, Playful</div>
        </div>
        <div class="level-card level-9" onclick="selectLevel(9)" 
             tabindex="0" role="button" 
             aria-label="Select Level 9: Peak States"
             onkeypress="handleKeyPress(event, 9)">
          <div class="level-emoji">ğŸ’š</div>
          <div class="level-title">Level 9: Peak States</div>
          <div class="level-emotions">Blissful, Enlightened, Ecstatic, Unconditionally Loving</div>
        </div>
      </div>
    </div>
  </div>

  <div id="guidanceScreen" class="overlay" style="display: none;">
    <div class="game-container">
      <h2 style="color: #2c3e50; margin-bottom: 20px;">Guidance & Techniques</h2>
      <div class="progress-indicator" id="guidanceProgress" style="display: none;">
        Explored levels: 0/9
      </div>
      <div id="guidanceText" class="content-text">
        Here you will see your level-specific strategies.
      </div>
      <button class="back-button" onclick="goBack()" aria-label="Go back to level selection">â† Back to Levels</button>
    </div>
  </div>

  <div id="actionScreen" class="overlay" style="display: none;">
    <div class="game-container">
      <h2 style="color: #2c3e50; margin-bottom: 20px;">Your Action Plan</h2>
      <div class="progress-indicator" id="actionProgress" style="display: none;">
        Explored levels: 0/9
      </div>
      <div id="actionText" class="action-text">
        This is where your practical steps will appear.
      </div>
      <button class="back-button" onclick="goToGuidance()" aria-label="Go back to guidance">â† Back to Guidance</button>
      <button class="start-button" onclick="endGame()" aria-label="Finish session">Finish</button>
    </div>
  </div>

  <script>
    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¸ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
    const gameState = {
      currentLevel: null,
      visitedLevels: new Set(),
      startTime: null,
      sessionData: [],
      isInitialized: false
    };

    // Ğ”ĞµĞ±Ğ°ÑƒĞ½ÑĞ¸Ğ½Ğ³ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞºĞ¾Ğ²
    let isTransitioning = false;

    function debounceClick(callback, delay = 300) {
      if (isTransitioning) return;
      isTransitioning = true;
      callback();
      setTimeout(() => isTransitioning = false, delay);
    }

    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
    function safeElementOperation(elementId, operation) {
      try {
        const element = document.getElementById(elementId) || document.querySelector(elementId);
        if (!element) {
          console.warn(`Element not found: ${elementId}`);
          showError('Interface element not found. Please refresh the page.');
          return false;
        }
        operation(element);
        return true;
      } catch (error) {
        console.error(`Error with element ${elementId}:`, error);
        showError('An error occurred. Please try again.');
        return false;
      }
    }

    function showError(message) {
      const errorElement = document.getElementById('errorMessage');
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        setTimeout(() => {
          errorElement.style.display = 'none';
        }, 5000);
      }
    }

    // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ
    function validateLevel(level) {
      return level >= 1 && level <= 9 && Number.isInteger(level) && !isNaN(level);
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
    function updateProgressIndicator() {
      const totalLevels = 9;
      const visitedCount = gameState.visitedLevels.size;
      const progressText = `Explored levels: ${visitedCount}/${totalLevels}`;
      
      ['progressIndicator', 'guidanceProgress', 'actionProgress'].forEach(id => {
        safeElementOperation(id, el => {
          el.textContent = progressText;
          el.style.display = visitedCount > 0 ? 'inline-block' : 'none';
        });
      });
    }

    // Moved formatActionText function down to prevent reference error.
    // function formatActionText(text) {
    //   if (!text) return '';
      
    //   return text
    //     .replace(/(\d+\.\s)/g, '<strong>$1</strong>')
    //     .replace(/(Goal:|Action Plan:|âš ï¸[^:]*:|âœ…[^:]*:|ğŸ”¥[^:]*:|ğŸ§­[^:]*:)/g, '<strong>$1</strong>')
    //     .replace(/^(ğŸ”´|ğŸŸ |ğŸŸ¡|ğŸŸ¢|ğŸ’š|âšª|ğŸŸ¤)(.+)$/gm, '<div class="level-highlight"><strong>$1$2</strong></div>');
    // }

    // ĞŸĞ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸
    function transitionToScreen(fromId, toId, callback) {
      const fromEl = document.getElementById(fromId);
      const toEl = document.getElementById(toId);
      
      if (!fromEl || !toEl) {
        console.error('Screen transition failed: elements not found');
        return;
      }

      // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ»Ğ°ÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
      fromEl.classList.add('loading');
      
      setTimeout(() => {
        fromEl.style.display = 'none';
        fromEl.classList.remove('loading');
        toEl.style.display = 'flex';
        
        if (callback) callback();
        
        // Ğ¤Ğ¾ĞºÑƒÑ Ğ½Ğ° Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚
        const firstButton = toEl.querySelector('button, .level-card');
        if (firstButton) {
          firstButton.focus();
        }
      }, 150);
    }

    // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ³Ñ€Ñ‹
    function initializeGame() {
      if (gameState.isInitialized) return;
      
      gameState.isInitialized = true;
      gameState.startTime = Date.now();
      
      // ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ°ÑƒĞ´Ğ¸Ğ¾
      const backgroundMusic = document.getElementById("backgroundMusic");
      if (backgroundMusic) {
        backgroundMusic.volume = 0.3; // Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½ÑƒÑ Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒ
        backgroundMusic.load();
      }
      
      console.log('Game initialized successfully');
    }

    // Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ³Ñ€Ñ‹
    function startGame() {
      debounceClick(() => {
        initializeGame();
        
        const backgroundMusic = document.getElementById("backgroundMusic");
        if (backgroundMusic) {
          backgroundMusic.play().catch(e => console.log('Audio play failed:', e));
        }
        
        transitionToScreen('introScreen', 'levelSelection');
      });
    }

    function selectLevel(level) {
      if (!validateLevel(level)) {
        console.error('Invalid level:', level);
        showError('Invalid level selected. Please try again.');
        return;
      }
      
      debounceClick(() => {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
        gameState.currentLevel = level;
        gameState.visitedLevels.add(level);
        
        updateProgressIndicator();
        
        transitionToScreen('levelSelection', 'guidanceScreen', () => {
          const guidanceText = guidanceTexts[level];
          if (guidanceText) {
            safeElementOperation('guidanceText', el => {
              el.innerHTML = `
                ${guidanceText}
                <br/><br/>
                <button class="start-button" onclick="goToActionPlan(${level})" aria-label="Show action plan for level ${level}">â†’ Show Action Plan</button>
              `;
            });
          }
        });
      });
    }

    function goToActionPlan(level) {
      if (!validateLevel(level)) {
        console.error('Invalid level for action plan:', level);
        return;
      }
      
      debounceClick(() => {
        transitionToScreen('guidanceScreen', 'actionScreen', () => {
          const rawText = actionPlans[level] || "Your custom action steps go here.";
          const formattedText = formatActionText(rawText);
          
          safeElementOperation('actionText', el => {
            el.innerHTML = formattedText;
            el.scrollTop = 0;
          });
        });
      });
    }

    function goToGuidance() {
      debounceClick(() => {
        transitionToScreen('actionScreen', 'guidanceScreen');
      });
    }

    function goBack() {
      debounceClick(() => {
        transitionToScreen('guidanceScreen', 'levelSelection');
      });
    }

    function endGame() {
      debounceClick(() => {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ÑĞµÑÑĞ¸Ğ¸
        gameState.sessionData.push({
          endTime: Date.now(),
          duration: Date.now() - gameState.startTime,
          levelsExplored: Array.from(gameState.visitedLevels),
          lastLevel: gameState.currentLevel
        });
        
        // Ğ¡Ğ±Ñ€Ğ¾Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸
        gameState.currentLevel = null;
        gameState.visitedLevels.clear();
        gameState.startTime = null;
        
        transitionToScreen('actionScreen', 'introScreen', () => {
          updateProgressIndicator();
        });
      });
    }

    // ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹
    function handleKeyPress(event, level) {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        selectLevel(level);
      }
    }

    // Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const currentScreen = document.querySelector('.overlay[style*="flex"]');
        if (currentScreen && currentScreen.id !== 'introScreen') {
          if (currentScreen.id === 'actionScreen') {
            goToGuidance();
          } else if (currentScreen.id === 'guidanceScreen') {
            goBack();
          }
        }
      }
    });

    // ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
    document.addEventListener('DOMContentLoaded', function() {
      // Ğ›ĞµĞ½Ğ¸Ğ²Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
      const images = ['background.png', 'container-background.png', 'logo.png', 'startbutton.png', 'apple-touch-icon.png', 'favicon-32x32.png', 'favicon-16x16.png', 'safari-pinned-tab.svg'];
      images.forEach(src => {
        const img = new Image();
        img.src = src;
      });
      
      // ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ñ… Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ - no longer needed as much with HTML formatting
      // window.formatRegexes = {
      //   numbers: /(\d+\.\s)/g,
      //   headers: /(Goal:|Action Plan:|âš ï¸[^:]*:|âœ…[^:]*:|ğŸ”¥[^:]*:|ğŸ§­[^:]*:)/g,
      //   levels: /^(ğŸ”´|ğŸŸ |ğŸŸ¡|ğŸŸ¢|ğŸ’š|âšª|ğŸŸ¤)(.+)$/gm
      // };
    });

    // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹
    const guidanceTexts = {
      1: "Level 1: Deep Negativity - Focus on basic self-care and reaching out for support. Small steps like deep breathing, gentle movement, or connecting with a trusted friend can help.",
      2: "Level 2: Heavy Experiences - Allow yourself to feel these emotions without judgment. Consider journaling, meditation, or engaging in activities that bring small moments of comfort.",
      3: "Level 3: Negative Activation - Channel this energy constructively through physical exercise, creative expression, or problem-solving. Take breaks to cool down when needed.",
      4: "Level 4: Neutral Negativity - Explore new activities or perspectives. Sometimes a change of environment or engaging with different content can shift your state.",
      5: "Level 5: Neutral State - This is a great foundation! Consider setting intentions, practicing gratitude, or engaging in activities that align with your values.",
      6: "Level 6: Light Positivity - Build on this momentum with learning something new, connecting with others, or pursuing interests that inspire you.",
      7: "Level 7: Active Positivity - Great energy for taking action on goals, helping others, or engaging in challenging but rewarding activities.",
      8: "Level 8: High Positivity - Share this joy with others, celebrate achievements, and consider how you can maintain this positive state.",
      9: "Level 9: Peak States - Embrace this beautiful state while staying grounded. Consider how you can integrate these feelings of connection and love into daily life."
    };

    const actionPlans = {
      1: `
        <div class="level-highlight"><strong>ğŸ”´ Level 1: Rock Bottom â€“ Despair / Apathy / Collapse</strong></div>
        <p><strong>ğŸ’¬ Typical Emotional State:</strong></p>
        <p>You feel utterly depleted â€” like nothing matters. There may be a sense of void, emotional numbness, or internal collapse. This is the lowest emotional frequency, often marked by deep despair, isolation, or complete lack of motivation.</p>

        <p><strong>ğŸ§  Associated Emotions:</strong></p>
        <ul>
            <li>Apathy</li>
            <li>Deep Grief</li>
            <li>Numbness</li>
            <li>Total Fatigue</li>
            <li>Hopelessness</li>
            <li>Collapse</li>
            <li>Suicidal Thoughts (in extreme cases)</li>
            <li>Emotional Freeze</li>
            <li>Emptiness</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li>Complete disconnection from reality or the body</li>
            <li>Belief that nothing can help or change</li>
            <li>Isolation becomes seductive â€” "No one gets it, so why try"</li>
            <li>Self-abandonment or emotional shutdown</li>
            <li>Suicidal ideation or existential dread if left unchecked</li>
        </ul>
        <p><strong>Note:</strong> This level can be clinical. If someone is stuck here for days or weeks, professional support may be required.</p>

        <p><strong>ğŸªœ Strategies to Begin Moving Up:</strong></p>
        <p>The goal here is not motivation, but activation â€” to wake up the system gently.</p>
        <ul>
            <li><strong>Gentle physical stimulation:</strong> Take a cold or warm shower. Move fingers or stretch slowly. Even 1 push-up counts.</li>
            <li><strong>Basic sensory grounding:</strong> Light a scented candle, listen to calming music, touch something soft. Come back into the body.</li>
            <li><strong>Micro-commitment:</strong> Promise to do one tiny thing today: drink a glass of water, open a window, brush your teeth.</li>
            <li><strong>Compassionate voice:</strong> Say: â€œItâ€™s okay to feel this. Iâ€™m still here.â€ Use a journal or voice note â€” even 10 seconds helps.</li>
            <li><strong>Connect â€” even passively:</strong> Listen to a podcast, message someone â€œIâ€™m here,â€ or ask for a hug. Even if it feels fake â€” do it.</li>
        </ul>

        <p><strong>ğŸ§¨ Risk Snapshot:</strong></p>
        <ul>
            <li>Getting stuck in an emotional freeze</li>
            <li>Letting shame block any attempts at change (â€œI should be strongerâ€)</li>
            <li>Using substances or distractions to escape (binge-watching, alcohol, doom-scrolling)</li>
        </ul>

        <p><strong>ğŸ› ï¸ Supportive Practices:</strong></p>
        <ul>
            <li>Nap + hydrate (this helps regulate cortisol + adrenaline)</li>
            <li>Pet an animal or hug a pillow (oxytocin release)</li>
            <li>Crying (if it comes) â€” is a healthy nervous system release</li>
            <li>Speak to one safe person â€” even if only to say â€œIâ€™m not okayâ€</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>This is not your forever state. You are not broken â€” you're overloaded, under-supported, or simply burned out. Your system shut down to protect itself. Now we gently reboot.</p>
      `,

      2: `
        <div class="level-highlight"><strong>ğŸŸ  Level 2: Heavy Experiences â€“ Emotional Fatigue, Numbness, and Despair Under the Surface</strong></div>
        <p><strong>ğŸ’¬ Typical Emotional State:</strong></p>
        <p>You're functional but disconnected. You might be going through the motions, but inside â€” you feel disappointed, emotionally flat, or hopeless. This is the â€œlow-battery modeâ€ of life: not rock bottom, but not alive either.</p>

        <p><strong>ğŸ§  Associated Emotions:</strong></p>
        <ul>
            <li>Disappointed</li>
            <li>Emotionally Exhausted</li>
            <li>Empty</li>
            <li>Numb</li>
            <li>Hopeless</li>
            <li>Withdrawn</li>
            <li>Resigned</li>
            <li>Bored but unable to act</li>
            <li>Quiet sadness that doesnâ€™t speak</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Traps:</strong></p>
        <ul>
            <li>Going on autopilot, pretending everythingâ€™s fine</li>
            <li>Emotional suppression (â€œI shouldnâ€™t feel this wayâ€)</li>
            <li>Losing touch with desire â€” you forget what excites you</li>
            <li>Engaging in silent sabotage (procrastination, isolation, checking out)</li>
            <li>Comparison to others who seem â€œaheadâ€ or â€œmore aliveâ€</li>
        </ul>

        <p><strong>ğŸªœ Strategies to Move Up:</strong></p>
        <ul>
            <li><strong>Name it to claim it:</strong> Identify your exact feeling. Use the Emotion Wheel if needed. Say it out loud or write: â€œI feel ___ right now.â€</li>
            <li><strong>Nourishing movement:</strong> Gentle yoga, a slow walk, 5 minutes of dancing. The goal is not â€œexercise,â€ but reconnecting with your body.</li>
            <li><strong>Tiny pleasures:</strong> Drink your favorite tea. Sit in the sun. Put on music that feels like home. These spark micro-emotions, essential for recovery.</li>
            <li><strong>Talk to someone without solutions:</strong> Just be heard. Say: â€œI donâ€™t need advice, I just need to vent.â€</li>
            <li><strong>Rediscover small purpose:</strong> Make something. Write. Cook. Organize a drawer. Anything that reaffirms agency.</li>
        </ul>

        <p><strong>ğŸ§¨ Risks at This Level:</strong></p>
        <ul>
            <li>Acting numb when you're actually overwhelmed</li>
            <li>Pushing through without addressing inner depletion</li>
            <li>Suppressing so long that emotions build up into anxiety or anger</li>
            <li>Mistaking apathy for laziness (â€œWhy canâ€™t I just be productive?â€)</li>
        </ul>

        <p><strong>ğŸ§  Conscious Decision-Making:</strong></p>
        <p>Donâ€™t make big decisions from this level â€” theyâ€™re often rooted in avoidance or escape.</p>
        <p>Instead, ask:</p>
        <ul>
            <li>What do I need to feel 10% better?</li>
            <li>What is one boundary I need to re-establish?</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>This level often appears right before breakthroughs. The heaviness is a message: your system is saying â€œI canâ€™t live like this anymore.â€ Thatâ€™s not a weakness. Thatâ€™s inner intelligence.</p>
      `,

      3: `
        <div class="level-highlight"><strong>ğŸ”´ Level 3: Negative Activation</strong></div>
        <p><strong>ğŸ’¬ Typical Emotional State:</strong></p>
        <p>Tense, restless, irritated, impulsive, scattered, hyper-activated but not focused. You feel like youâ€™re doing something â€” but not necessarily the right things.</p>

        <p><strong>ğŸ§  Associated Emotions (from emotion wheels):</strong></p>
        <ul>
            <li>Frustration</li>
            <li>Anxiety</li>
            <li>Stress</li>
            <li>Impatience</li>
            <li>Overwhelm</li>
            <li>Confusion</li>
            <li>Agitation</li>
            <li>Urgency</li>
            <li>Hyper-productivity (driven by fear, not clarity)</li>
        </ul>

        <p><strong>ğŸ” Key Traits of This Level:</strong></p>
        <ul>
            <li>Youâ€™re active â€” but itâ€™s often reactive, not conscious or strategic.</li>
            <li>Often triggered by a fear of falling behind, missing out, or being judged.</li>
            <li>You might appear productive on the outside, but inside thereâ€™s chaotic urgency.</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Traps:</strong></p>
        <ul>
            <li>Overreacting â€” sending messages, quitting, or deciding things impulsively.</li>
            <li>Overcommitting â€” saying yes to everything because of pressure or fear of missing out.</li>
            <li>Avoiding root causes â€” staying â€œbusyâ€ to avoid uncomfortable introspection.</li>
            <li>Misinterpreting stress as motivation â€” mistaking tension for momentum.</li>
            <li>Making rushed decisions â€” buying things, launching too soon, miscommunicating.</li>
        </ul>
        <p><strong>âš¡ Example:</strong> You feel anxious about your future, so you sign up for five coursesâ€¦ but donâ€™t finish any of them.</p>

        <p><strong>âœ… Strategies to Move Up to Constructive Energy / Clarity:</strong></p>
        <ul>
            <li><strong>Pause before reacting:</strong> Ask: â€œAm I responding to reality, or to fear?â€</li>
            <li><strong>Rechannel the energy:</strong> Go for a short run, do breathwork, shake out the tension, or dance â€” burn the static charge.</li>
            <li><strong>Practice the 3-Minute Mind Dump:</strong> Write every thought, to-do, and worry on paper. No filter. Just empty your mind.</li>
            <li><strong>Name the emotion honestly:</strong> "I'm not just busy, Iâ€™m overwhelmed and scared Iâ€™ll fail." Naming is taming.</li>
            <li><strong>Reconnect with your values:</strong> Ask: "Is what Iâ€™m doing aligned with what actually matters to me?"</li>
            <li><strong>Focus on a single priority:</strong> Pick one small task. Complete it slowly, mindfully. Feel the shift.</li>
        </ul>

        <p><strong>âš¡ Power-Up Move:</strong></p>
        <p>Do 30 seconds of â€œBox Breathingâ€:</p>
        <ul>
            <li>Inhale 4s â†’ Hold 4s â†’ Exhale 4s â†’ Hold 4s. Repeat 4 times.</li>
        </ul>
        <p>This activates the parasympathetic nervous system, reducing impulsivity and improving clarity.</p>

        <p><strong>ğŸš¨ What to Watch Out For (Even When Improving):</strong></p>
        <ul>
            <li><strong>False clarity:</strong> After releasing tension, don't rush to make decisions immediately â€” give yourself a â€œcooldown.â€</li>
            <li><strong>Overconfidence:</strong> As energy rises, be cautious of manic optimism (e.g., sudden risky investments).</li>
            <li><strong>External validation loop:</strong> Donâ€™t let momentum be hijacked by social media likes or praise â€” stay internally focused.</li>
        </ul>

        <p><strong>ğŸ§­ Reframing This Stage:</strong></p>
        <p>This is not a bad stage â€” itâ€™s just unrefined power. Think of it like steam building up in a pressure cooker. You can either explode or redirect the energy into useful motion.</p>
      `,

      4: `
        <div class="level-highlight"><strong>ğŸŸ¤ Level 4: Stabilization & Neutral</strong></div>
        <p><strong>ğŸ’¬ Typical Emotional State:</strong></p>
        <p>Balanced, calm, indifferent, grounded, â€œokay.â€ Youâ€™re no longer reactive â€” but not yet inspired or energized either. A crucial pivot point in the emotional ladder.</p>

        <p><strong>ğŸŒ¤ï¸ Associated Emotions:</strong></p>
        <ul>
            <li>Neutral</li>
            <li>Stable</li>
            <li>Content</li>
            <li>Accepting</li>
            <li>Mild interest</li>
            <li>Calm</li>
            <li>Open</li>
            <li>Reflective</li>
            <li>Centered</li>
            <li>Disconnected (but not negatively)</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li>Staying too long in â€œneutral gearâ€ â€” comfortable but stagnant.</li>
            <li>Mistaking stability for progress â€” no real movement forward.</li>
            <li>Emotional numbness â€” confusing peace with disconnection.</li>
            <li>Avoiding ambition â€” rejecting desire to avoid risk.</li>
            <li>Procrastination disguised as presence â€” â€œIâ€™m just going with the flowâ€ without direction.</li>
        </ul>
        <p><strong>ğŸ§  Example:</strong> You feel better than before, but can't seem to push forward. You keep organizing, preparing, thinking â€” but not doing anything meaningful.</p>

        <p><strong>âœ… Strategies to Move Up into Engagement & Positive Momentum:</strong></p>
        <ul>
            <li><strong>Reconnect with curiosity:</strong> Ask: â€œWhat could be interesting right now?â€ or â€œWhat would feel satisfying to create or explore?â€</li>
            <li><strong>Do a 5-minute â€œmomentum builderâ€ task:</strong> Small win that gives a sense of progress: clean a drawer, send one email, sketch one idea.</li>
            <li><strong>Visualize best-case future:</strong> Use the â€œ3 Months From Nowâ€ prompt: â€œIf I felt proud and aligned 3 months from nowâ€¦ what would I be doing today?â€</li>
            <li><strong>Choose one low-stakes creative action:</strong> Draw. Write freely. Reorganize your space. Make a playlist. Create without pressure.</li>
            <li><strong>Ground your body:</strong> Light stretching, walking barefoot, tai chi, breath-led yoga â€” builds presence and energy.</li>
        </ul>
        <p>Ask yourself:</p>
        <ul>
            <li>â€œWhatâ€™s one area in life Iâ€™ve been putting off improving, but now feel ready to look at with honesty?â€</li>
        </ul>

        <p><strong>âš¡ Power-Up Move:</strong></p>
        <p>Do the â€œEnergy Check-Inâ€:</p>
        <ul>
            <li><strong>Body:</strong> How do I feel physically?</li>
            <li><strong>Mind:</strong> Whatâ€™s the loudest thought?</li>
            <li><strong>Emotion:</strong> Whatâ€™s the background emotion?</li>
            <li><strong>Soul:</strong> What do I quietly desire?</li>
        </ul>
        <p>This creates internal coherence and readiness for flow.</p>

        <p><strong>ğŸš¨ What to Watch Out For (Even at This Good Stage):</strong></p>
        <ul>
            <li><strong>Safe zone syndrome:</strong> Youâ€™ve exited chaos, but resist challenge.</li>
            <li><strong>â€œEverythingâ€™s fineâ€ mode:</strong> Progress slows because urgency is gone.</li>
            <li>Over-reflection without action.</li>
            <li>Disconnection from deeper desire â€” you may settle for comfort, not vitality.</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>This level is a launchpad, not a resting place. Stability gives you the platform to build. From here, you can consciously direct energy into purpose, joy, and deeper flow â€” but you must choose to act.</p>
      `,

      5: `
        <div class="level-highlight"><strong>âšª Level 5: Willingness / Hope / Mild Positivity</strong></div>
        <p><strong>ğŸ’¬ Typical Emotional State:</strong></p>
        <p>Youâ€™re open. Curious. Ready to engage. Not quite inspired, but no longer stuck â€” this is the beginning of upward momentum.</p>

        <p><strong>ğŸŒŸ Associated Emotions:</strong></p>
        <ul>
            <li>Hopeful</li>
            <li>Optimistic</li>
            <li>Interested</li>
            <li>Willing</li>
            <li>Curious</li>
            <li>Open-minded</li>
            <li>Encouraged</li>
            <li>Eager (mildly)</li>
            <li>Motivated (starting to emerge)</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li>Overestimating readiness â€” taking on too much too fast can overwhelm this delicate stage.</li>
            <li>Lack of clear direction â€” momentum without aim leads to scattered effort.</li>
            <li>Relying too much on external validation â€” still not fully rooted in intrinsic drive.</li>
            <li>Avoiding deeper internal work â€” trying to "stay positive" without resolving lingering issues.</li>
        </ul>
        <p><strong>ğŸ§  Example:</strong> You start a project with enthusiasm but abandon it after two days. Energy is rising â€” but lacks structure or grounding.</p>

        <p><strong>âœ… Strategies to Move Up into True Positivity & Flow:</strong></p>
        <ul>
            <li><strong>Set small, clear intentions:</strong> Not massive goals â€” just a next step with meaning (e.g. â€œReach out to one person I admireâ€).</li>
            <li><strong>Track micro-wins:</strong> Each small success builds confidence and reinforces upward movement. Try journaling â€œ3 wins a day.â€</li>
            <li><strong>Practice emotional momentum:</strong> Notice and extend moments when you feel uplifted (amplify instead of dismissing them).</li>
            <li><strong>Connect with purpose, not pressure:</strong> Ask: â€œWhy does this matter to me personally?â€ Focus on contribution and meaning.</li>
            <li><strong>Use movement to shift energy:</strong> Dance, walk with intention, tidy your space with music â€” use your body to support forward emotion.</li>
            <li><strong>Surround yourself with inspiration:</strong> Podcasts, people, quotes â€” everything around you should reinforce upward direction.</li>
        </ul>

        <p><strong>âš¡ Power-Up Move:</strong></p>
        <p>Do a â€œCourage Ritualâ€ â€”</p>
        <ul>
            <li>Commit to one thing today thatâ€™s slightly uncomfortable but aligned with growth (send a pitch, ask a question, apply to something). This builds emotional muscle and trust in yourself.</li>
        </ul>

        <p><strong>ğŸš¨ What to Watch Out For:</strong></p>
        <ul>
            <li>â€œToxic optimismâ€ â€” skipping over real fears or doubts in favor of forced positivity.</li>
            <li>Shiny-object syndrome â€” jumping from one idea to another without finishing.</li>
            <li>Premature self-comparison â€” seeing others further ahead and spiraling downward again.</li>
            <li>Fear of momentum â€” low-key sabotage due to fear of success.</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>Willingness is the bridge between neutrality and creativity. Itâ€™s where real personal transformation begins â€” not in massive breakthroughs, but in small consistent actions. This is where the Flow state starts to become possible â€” as your energy and trust return.</p>
      `,

      6: `
        <div class="level-highlight"><strong>ğŸŸ¡ Level 6: Contentment / Calm Joy / Satisfaction</strong></div>
        <p><strong>ğŸŒ¿ Typical Emotional State:</strong></p>
        <p>You feel good â€” not ecstatic, but grounded and genuinely okay. Thereâ€™s a sense of peace, lightness, and presence. Youâ€™re not rushing, not grasping â€” and that's powerful.</p>

        <p><strong>ğŸŒŸ Associated Emotions (from Wheel references):</strong></p>
        <ul>
            <li>Calm</li>
            <li>Relaxed</li>
            <li>Satisfied</li>
            <li>Grateful</li>
            <li>Light-hearted</li>
            <li>Present</li>
            <li>Balanced</li>
            <li>Comfortable</li>
            <li>Steady</li>
            <li>Appreciative</li>
        </ul>

        <p><strong>âœ… Strategies to Move Up into Enthusiasm, Passion & Flow:</strong></p>
        <ul>
            <li><strong>Tune into gratitude:</strong> Identify 3 small things that bring you peace right now (e.g., sunlight, coffee aroma, a finished task).</li>
            <li><strong>Create from stillness:</strong> This is a great place to write, plan, or make art â€” without pressure.</li>
            <li><strong>Simplify:</strong> Let go of tasks or ideas that clutter your mind. Focus on what matters most today.</li>
            <li><strong>Go deeper with presence:</strong> Practice mindfulness. Slow meals, mindful walks, gentle meditation. These amplify contentment.</li>
            <li><strong>Share light energy:</strong> A simple compliment, a smile, or helping hand deepens your own experience of well-being.</li>
            <li><strong>Do small acts of alignment:</strong> Tidy a corner, stretch your back, drink water. Harmony in small actions reinforces this stable energy.</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li><strong>Complacency:</strong> Staying in contentment too long can cause stagnation or missed growth opportunities.</li>
            <li><strong>Fear of shaking peace:</strong> Avoiding challenges because they may disturb your balance (which can block progress).</li>
            <li>Underestimating your potential: Settling for â€œokayâ€ when youâ€™re ready for â€œamazing.â€</li>
        </ul>
        <p><strong>ğŸ§  Example:</strong> You feel good and don't want to ruin it â€” so you put off sending that important application. But staying here too long can mean missing the window of momentum.</p>

        <p><strong>ğŸ”¥ Power-Up Move:</strong></p>
        <ul>
            <li>Ask: â€œWhat would my calmest, wisest self gently stretch into right now?â€ Then do that. Keep it light, but directed.</li>
        </ul>

        <p><strong>ğŸš¨ What to Watch Out For:</strong></p>
        <ul>
            <li>Pleasure over purpose.</li>
            <li>Staying in comfort zones at the expense of growth.</li>
            <li>Drift mode.</li>
            <li>Floating through days without checking alignment.</li>
            <li>Fading emotional edge.</li>
            <li>Losing passion if contentment turns into disengagement.</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>Contentment is a powerful launchpad. From here, you can build sustainable momentum toward creative energy, passion, and purpose â€” without burning out. Enjoy it â€” but donâ€™t settle if your soul is calling for more.</p>
      `,

      7: `
        <div class="level-highlight"><strong>ğŸŸ¢ Level 7: Optimism / Curiosity / Interest</strong></div>
        <p><strong>ğŸŒŸ Typical Emotional State:</strong></p>
        <p>This level is your turning point. You begin to look toward the future with hope. Your mind starts generating ideas, asking questions, wanting to move toward something.</p>

        <p><strong>ğŸ’¬ Associated Emotions (from Wheel & Ladder references):</strong></p>
        <ul>
            <li>Curious</li>
            <li>Interested</li>
            <li>Hopeful</li>
            <li>Optimistic</li>
            <li>Open-minded</li>
            <li>Playful</li>
            <li>Engaged</li>
            <li>Alert</li>
            <li>Energetic</li>
            <li>Lightly Motivated</li>
        </ul>

        <p><strong>âœ… Strategies to Move Up into Enthusiasm & Inspired Action:</strong></p>
        <ul>
            <li><strong>Follow the spark:</strong> Ask: â€œWhat feels interesting right now?â€ Then give it 15â€“30 minutes of focused attention.</li>
            <li><strong>Set a micro-goal:</strong> Not a big outcome. Just the next meaningful step â€” clarity fuels momentum.</li>
            <li><strong>Brainstorm freely:</strong> Capture ideas without judging. Let imagination run before refining.</li>
            <li><strong>Change environments:</strong> Move to a cafÃ©, library, park, or new workspace. New surroundings = fresh curiosity.</li>
            <li><strong>Ask better questions:</strong> Shift from â€œWhy canâ€™t I?â€ to â€œWhatâ€™s possible from here?â€</li>
            <li><strong>Connect with other curious minds:</strong> Share an idea with someone who energizes you â€” community multiplies interest.</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li><strong>Scattered attention:</strong> Curiosity can fragment into distractions. Stay focused on aligned exploration.</li>
            <li><strong>Chronic ideation:</strong> Constant thinking without action = idea fatigue. <strong>Strategy:</strong> Balance 1 idea with 1 concrete step.</li>
            <li>Overplanning: Trying to mentally map everything before beginning can kill the spark.</li>
            <li>False starts: Jumping from one thing to the next without finishing anything leads to overwhelm.</li>
        </ul>

        <p><strong>ğŸ”¥ Power-Up Move:</strong></p>
        <p>Start a â€œMomentum Journal.â€ Each day, note:</p>
        <ul>
            <li>What sparked curiosity?</li>
            <li>What 1 thing did you try or explore?</li>
            <li>Whatâ€™s worth continuing?</li>
        </ul>

        <p><strong>ğŸš¨ What to Watch For:</strong></p>
        <ul>
            <li>Seeking novelty for escape.</li>
            <li>Curiosity used to avoid discomfort, not to grow.</li>
            <li>Fear of failing early.</li>
            <li>At this stage, experimentation > perfection â€” donâ€™t hold back.</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>This level is about opening doors. You donâ€™t need to know everything â€” you just need to trust that exploring will reveal the path. Curiosity is a bridge to higher energy and flow. Use it well â€” and youâ€™ll soon be in states of joy, creativity, and even personal breakthroughs.</p>
      `,

      8: `
        <div class="level-highlight"><strong>ğŸŸ¡ Level 8: Enthusiasm / Motivation / Purpose</strong></div>
        <p><strong>ğŸŒŸ Typical Emotional State:</strong></p>
        <p>Now youâ€™re fully engaged. Youâ€™ve moved from thinking to doing â€” and you feel aligned with your actions. Thereâ€™s a sense of inner drive, direction, and upliftment.</p>

        <p><strong>ğŸ’¬ Associated Emotions:</strong></p>
        <ul>
            <li>Enthusiastic</li>
            <li>Motivated</li>
            <li>Purposeful</li>
            <li>Eager</li>
            <li>Excited</li>
            <li>Empowered</li>
            <li>Inspired</li>
            <li>Focused</li>
            <li>Confident</li>
            <li>Joyfully Determined</li>
        </ul>

        <p><strong>âœ… Strategies to Move Up Toward Passion / Joy:</strong></p>
        <ul>
            <li><strong>Channel energy into aligned action:</strong> Use this energy to build momentum on what truly matters. Prioritize meaningful projects.</li>
            <li><strong>Reconnect with purpose:</strong> Ask: Why is this important to me? Who am I doing this for?</li>
            <li><strong>Create momentum rituals:</strong> Start the day with a short win or micro habit to reinforce motivation.</li>
            <li><strong>Celebrate progress:</strong> Acknowledge small achievements â€” it locks in positive reinforcement and keeps energy flowing.</li>
            <li><strong>Work in deep-focus blocks:</strong> 90 minutes of uninterrupted, immersive work helps you drop into flow faster.</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li><strong>Overexcitement â†’ burnout:</strong> Riding high can tempt you to overcommit. Remember: energy is renewable, not infinite.</li>
            <li><strong>Losing touch with rest:</strong> Enthusiasm can mask exhaustion. Schedule recovery just like action.</li>
            <li><strong>Tunnel vision:</strong> Too much focus can block helpful feedback or new opportunities. Stay open while staying driven.</li>
            <li><strong>Chasing passion for its own sake:</strong> If you pursue â€œhypeâ€ rather than alignment, you risk crashing when things get hard.</li>
        </ul>

        <p><strong>ğŸ”¥ Power-Up Move:</strong></p>
        <p>The â€œWhy 5xâ€ Drill</p>
        <ul>
            <li>Take a task and ask â€œWhy is this important to me?â€ Then repeat your answer 5 times, each time going deeper. Youâ€™ll uncover intrinsic motivation â€” the fuel that lasts.</li>
        </ul>

        <p><strong>ğŸš¨ What to Watch For:</strong></p>
        <ul>
            <li>Acting impulsively just because energy is high</li>
            <li>Making big decisions (e.g., quitting job, starting business, ending relationship) without grounding</li>
            <li>Ignoring emotional signs of fatigue because â€œIâ€™m on a rollâ€</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>This level is where meaning meets energy. Itâ€™s not just about doing more â€” itâ€™s about doing what moves you and feeling that fire as fuel. If you learn to harness it wisely, enthusiasm becomes a gateway to Flow and Peak States.</p>
      `,

      9: `
        <div class="level-highlight"><strong>ğŸ’š Level 9: Passion / Flow / Excitement</strong></div>
        <p><strong>ğŸŒŸ Typical Emotional State:</strong></p>
        <p>This is where you're in the zone. Time dilates. Energy feels limitless. Youâ€™re deeply aligned â€” emotionally, mentally, even physically â€” and it shows in your performance, joy, and clarity.</p>

        <p><strong>ğŸ’¬ Associated Emotions:</strong></p>
        <ul>
            <li>Passionate</li>
            <li>Flowing</li>
            <li>Electrified</li>
            <li>Empowered</li>
            <li>Absorbed</li>
            <li>Alive</li>
            <li>Vibrant</li>
            <li>Ecstatic</li>
            <li>Creative</li>
            <li>Limitless</li>
        </ul>

        <p><strong>âœ… Strategies to Sustain or Deepen the State:</strong></p>
        <ul>
            <li><strong>Minimize distractions:</strong> Protect your flow space. Turn off notifications. Set boundaries.</li>
            <li><strong>Ride the wave, but donâ€™t over-surf:</strong> Work in cycles. Use Pomodoro-style sprints and scheduled breaks to avoid burnout.</li>
            <li><strong>Balance emotion with structure:</strong> Flow thrives on freedom within form. Define goals, then surrender to the process.</li>
            <li><strong>Reflect and integrate:</strong> After a peak session, pause. What worked? What triggered flow? Capture it.</li>
            <li><strong>Keep the nervous system stable:</strong> High excitement can crash into fatigue. Nourish your body: hydrate, breathe, stretch.</li>
        </ul>

        <p><strong>âš ï¸ Common Pitfalls / Hidden Traps:</strong></p>
        <ul>
            <li><strong>Flow addiction:</strong> Chasing only peak states can lead to avoidance of necessary low-energy tasks.</li>
            <li><strong>Overconfidence:</strong> Excitement can cause poor decisions â€” risky investments, impulsive promises, or skipping due diligence.</li>
            <li><strong>Ignoring your needs:</strong> Flow can make you forget hunger, fatigue, or emotional undercurrents. Check in with your body.</li>
            <li><strong>Romanticizing chaos:</strong> Passion without grounding can feel powerful, but becomes unstable over time.</li>
        </ul>

        <p><strong>ğŸ§¨ Risk Snapshot:</strong></p>
        <ul>
            <li>You might trust too easily â†’ scams / manipulation</li>
            <li>You might scale too fast without foundation</li>
            <li>You might neglect relationships or self-care chasing creative highs</li>
        </ul>

        <p><strong>ğŸ› ï¸ Grounding Practices:</strong></p>
        <ul>
            <li>Do a 5-minute body scan</li>
            <li>Journal after each high-flow moment to reflect, not just rush forward</li>
            <li>Walk in nature to discharge excessive energy</li>
            <li>Anchor your excitement in values and long-term vision</li>
        </ul>

        <p><strong>ğŸ§­ Reframe for Growth:</strong></p>
        <p>Flow is not a goal â€” itâ€™s a side effect of clarity, alignment, and surrender. Use it as a signal that you're on the right path, not as a drug to escape low states. Youâ€™re not chasing the feeling â€” youâ€™re becoming the person who lives in that frequency more often.</p>
      `
    };

    // Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒÑ
    let currentVolume = 0.3;
    
    function createVolumeControl() {
  const volumeControl = document.createElement('div');
  volumeControl.id = 'volumeControl';
  volumeControl.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 25px;
    padding: 10px 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    transition: all 0.3s ease;
    cursor: pointer;
  `;
  
  volumeControl.innerHTML = `
    <span style="font-size: 1.2em;">ğŸ”Š</span>
    <span style="font-size: 0.9em; color: #888;">Sound</span>
  `;
  
  document.body.appendChild(volumeControl);
  
  let isPlaying = false;
  const backgroundMusic = document.getElementById('backgroundMusic');
  const icon = volumeControl.querySelector('span');
  
  volumeControl.addEventListener('click', function() {
    if (backgroundMusic) {
      if (isPlaying) {
        backgroundMusic.pause();
        icon.textContent = 'ğŸ”‡';
        isPlaying = false;
      } else {
        backgroundMusic.play().catch(e => console.log('Audio play failed:', e));
        icon.textContent = 'ğŸ”Š';
        isPlaying = true;
      }
    }
  });
}

    // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ° Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
    document.addEventListener('DOMContentLoaded', function() {
      createVolumeControl();
      
      // Ğ›ĞµĞ½Ğ¸Ğ²Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
      const images = ['background.png', 'container-background.png', 'logo.png', 'startbutton.png'];
      images.forEach(src => {
        const img = new Image();
        img.src = src;
      });
      
      // ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ñ… Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ - Removed as we're using direct HTML now
      // window.formatRegexes = {
      //   numbers: /(\d+\.\s)/g,
      //   headers: /(Goal:|Action Plan:|âš ï¸[^:]*:|âœ…[^:]*:|ğŸ”¥[^:]*:|ğŸ§­[^:]*:)/g,
      //   levels: /^(ğŸ”´|ğŸŸ |ğŸŸ¡|ğŸŸ¢|ğŸ’š|âšª|ğŸŸ¤)(.+)$/gm
      // };
    });

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°
    function formatActionText(text) {
      // Since the actionPlans now contain full HTML, we just return the text directly.
      // Any specific formatting will be handled by the CSS for .action-text ul, li, strong, etc.
      return text;
    }

    console.log('Flow Game loaded successfully');
  </script>
</body>
</html>
